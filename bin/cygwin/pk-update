#!/bin/bash

. pk-common

cd "$INSTALL_PATH"

# echo "Downgrade libpng"
# rm mingw-libpng*
# cp ../packages2/mingw-libpng* .

clean=1

# Update packages
for file in mingw-*.tar.bz2
do
  desc=${file/.tar.bz2/.desc}
  ver=`cat "$desc" | pk-print-ver`
  name=${file%.tar.bz2}
  pkg=${name%-$ver}
  tmp_deps=`pk-make-tmp`

  # check package version
  ver2=`pk-find-desc "$pkg" | pk-print-ver`
  [ "$ver2" == "$ver" ] && continue

  pk-setup-package "$pkg"
  echo "$pkg updated $ver -> $ver2"
  rm "$file" "$desc"

  # check for new deps
  pk-make-dep-list2 "$pkg" pk-find-desc pk-setup-status > "$tmp_deps"

  cat "$tmp_deps" | while read pkg_dep
  do
    echo "Setup $pkg_dep as dependency for $pkg"
    pk-setup-package "$pkg_dep"
  done

  clean=0
done

[ "$clean" -eq 1 ] && echo "Everything is up-to-date"
