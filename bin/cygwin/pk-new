#!/bin/bash

set -e

. pk-common

on_exit()
{
  rm -f "$tmp_files"
  rm -f "$tmp_set"
}

trap 'on_exit' EXIT

cd "$BUILD_PATH"

# find all files in root
tmp_files=`mktemp`
find . -type f > "$tmp_files"

# remove files from installed packages
cd "$LIST_DIR"
tmp_set=`mktemp`
ls | while read file
do
  # set complement - files int $tmp_files that are not in $file
  comm -23 <(sort "$tmp_files") <(sort "$file") > "$tmp_set"
  cp "$tmp_set" "$tmp_files"
done

cat "$tmp_set"
