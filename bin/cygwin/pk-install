#!/bin/bash

. pk-common

name="$1"

pk-create-local-dirs

[ -z "$name" ] && { echo "ERROR: package not specified"; exit 1; }

dir=`readlink -f .`
pk_install_dir="$dir"
tmp_deps=`pk-make-tmp`
pk-make-dep-list2 "$name" pk-local-desc pk-install-status > "$tmp_deps"

# set -x
cat "$tmp_deps" | while read name
do
  pk-check-clash2 "$name" "$dir" "$dir/packages"

  echo "install $name"

  pk-extract2 "$name" "$dir" "$INSTALL_PATH"
  mkdir "$dir/packages/$name"
  cp -r "$INSTALL_PATH/$name"/{desc,*.tar.bz2} "$dir/packages/$name"
done

[ -s "$tmp_deps" ] || echo "Everything is installed"
