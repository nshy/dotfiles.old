#!/bin/bash
# Usage: PROGRAM_NAME [EXE [DIR]]
#   Copy all non-windows dll dependencies of EXE to DIR

set -e

. functions

exe=${1:-app\.exe}
dir=${2:-build}

if [[ ! -x $exe ]]
then
  echo "Error: $exe is not an executable"
fi

if [[ ! -d $dir ]]
then
  echo "Error: $dir is not a directory"
fi

if [[ ! -d $dir || ! -x $exe ]]
then
  echo
  print_help "$0"
  exit 1
fi

cygcheck "$exe" | tail -n +3 | grep -v system32 | \
  sed 's/\\/\//g;s/e:\/cygwin//i' - | while read file
do
  echo "$file"
  cp "$file" "$dir"
done
