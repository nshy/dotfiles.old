#!/bin/bash

set -e

. pk-common

package_name="$1"
dir="$2"

on_exit() { rm -f "$tmp_deps"; }
trap on_exit EXIT
tmp_deps=`mktemp`

cd "$INSTALL_PATH"
add_deps()
{
  declare deps file pack

  deps=`grep 'requires' "$1.desc"`
  deps=${deps#requires:}

  for pack in $deps
  do
    grep "$pack" "$MINGW_BASE" >&/dev/null && continue
    add_deps `pk-find-fun "$pack" "$INSTALL_PATH" "desc"`
  done

  [ -f "$dir/list/$1.list" ] && return
  echo "$1" >> "$tmp_deps"
}
add_deps "$package_name"

# find uniq lines without messing with sort
awk '!seen[$0]++' "$tmp_deps"
